# Database Schema Architecture

## üéØ Core Philosophy

This CRM supports **two organizational models**:

1. **Membership-Based Orgs** (F3, fitness groups, clubs)
   - Everyone is an `OrgMember`
   - Events pull from OrgMember list
   
2. **Donor-Based Orgs** (Nonprofits, fundraisers) 
   - Internal team = `OrgMember`
   - External donors/prospects = `Supporter`
   - Events pull from both

---

## üìä Main Models

### `Organization`
The master org account. One per customer.

**Key Fields:**
- `name`, `slug`, `mission`, `website`
- `pipelineDefaults` - Default funnel stages
- Social links, address

**Relations:**
- `members[]` - OrgMember (internal team + contacts)
- `supporters[]` - Supporter (donors/external) üî∏ **BREADCRUMB**
- `events[]` - Events
- `templates[]` - Message templates
- `contactLists[]` - Saved contact lists

---

### `OrgMember` ‚≠ê **PRIMARY CONTACT MODEL**
**The master contact list.** Every person in your universe.

**Dual Purpose:**
1. **App Access** (optional) - Team members who can login
2. **Contact Database** - Everyone you know

**Key Fields:**

**Contact Info:**
- `firstName`, `lastName`, `goesBy`, `email`, `phone`
- `street`, `city`, `state`, `zip`
- `employer`, `yearsWithOrganization`

**Personal:**
- `birthday`, `married`, `spouseName`, `numberOfKids`
- `originStory`, `notes`

**App Access (optional):**
- `role` - `"owner"` | `"manager"` | `null`
  - `owner` - Created the org, full control
  - `manager` - Delegated by owner, can manage events/campaigns
  - `null` - Just a contact (no login access)
- `googleId` - For OAuth login
- `photoURL` - Profile picture

**Leadership Tags:**
- `tags[]` - `["Board", "Committee", "VIP", "Donor", "Volunteer"]`
- Anyone can have leadership tags regardless of app access

**Engagement:**
- `categoryOfEngagement` - `"high"` | `"medium"` | `"low"` | `"inactive"`

**Relations:**
- `eventAttendees[]` - When invited to events
- `contactListMembers[]` - Membership in saved lists

**Example Use Cases:**
```
// Board member with app access
{
  firstName: "John",
  lastName: "Smith", 
  role: "manager",
  tags: ["Board", "Committee"]
}

// Regular contact (no app access)
{
  firstName: "Jane",
  lastName: "Doe",
  role: null,
  tags: ["VIP", "Donor"]
}

// Owner
{
  firstName: "Adam",
  lastName: "Owner",
  role: "owner",
  tags: ["Board"]
}
```

---

### `Supporter` üî∏ **BREADCRUMB FOR FUTURE**
**External donors/prospects for nonprofit orgs.**

Currently exists but **not actively used**. 

**Future Use Case:**
- Nonprofits with clear internal/external divide
- Corporate sponsors
- Grant organizations
- Anonymous donors

**Schema preserved for:**
- Donor-specific fields (giving history, capacity)
- Different data model than OrgMember
- Potential multi-org donor tracking

**For now:** Use `OrgMember` for everything.

---

### `EventAttendee` ‚≠ê **EVENT-SPECIFIC TRACKING**
**Links an OrgMember to a specific event with pipeline tracking.**

**Key Concept:** Same person can be in multiple events at different stages!

**Key Fields:**
- `contactId` - Links to universal person record (Contact)
- `eventId` - Which event
- `currentStage` - Pipeline stage for THIS event
  - `"in_funnel"`, `"general_awareness"`, `"personal_invite"`, etc.
- `audienceType` - How they were added
  - `"org_members"`, `"friends_family"`, `"landing_page_public"`, `"community_partners"`, `"cold_outreach"`
- `attended` - Did they show up?
- `amountPaid` - Ticket cost
- `ticketType` - VIP, General, etc.
- `notes` - JSON with custom form field responses

**Example:**
```
John Smith (OrgMember) invited to 3 events:

Event A (Bros & Brews):
  currentStage: "paid"
  attended: true
  
Event B (Golf Tournament):
  currentStage: "expressed_interest"
  attended: false
  
Event C (Gala):
  currentStage: "personal_invite"
  attended: false
```

---

### `Event`
Individual events/fundraisers.

**Key Fields:**
- `name`, `slug`, `description`, `date`, `time`
- `locationId` - Links to EventLocation (reusable venues)
- `customLocation` - One-off location string
- `hasTickets`, `ticketCost`
- `fundraisingGoal`, `additionalExpenses`
- `pipelines[]` - Custom stages or use org defaults

**Relations:**
- `attendees[]` - EventAttendee (who's invited/attending)
- `tasks[]` - EventTask (Asana-style task list)

---

### `EventTask` üéØ **ASANA-STYLE TASK MANAGEMENT**
**Per-event task system with AI-suggested tasks.**

**Key Fields:**
- `title`, `description`
- `category` - `"design"` | `"marketing"` | `"tech"` | `"logistics"` | `"finance"`
- `completed` - Boolean
- `dueDate` - When it's due
- `assignedTo` - Team member (future)
- `priority` - `"low"` | `"medium"` | `"high"`
- `orderIndex` - Display order

**Generated by:**
- `SetupEvent.jsx` survey ‚Üí `EventTaskSuggestions.jsx`
- User picks tasks to add
- Future: OpenAI generates custom tasks

---

### `EventLocation` üè¢ **REUSABLE VENUES**
**Track venues across events with ratings.**

**Key Fields:**
- `venueName`, `street`, `city`, `state`, `zip`
- `rating` - Venue quality (1-5)
- `timesUsed` - How many events held here
- `notes` - Pros/cons, contact info

**Used by:**
- Events can link to a saved location
- Or use `customLocation` for one-offs
- System learns which venues are best

---

## üîÑ Data Flow

### Creating a Contact List for an Event

**Old Way (Supporter-based):**
```
1. Import CSV ‚Üí Create Supporters
2. Tag Supporters ‚Üí "Bros&Brews_Invited"
3. Create Event
4. Link Supporters to Event
```

**New Way (OrgMember-based):**
```
1. Import CSV ‚Üí Create OrgMembers (master list)
2. Create Event
3. Select OrgMembers to invite
4. System creates EventAttendee records
   - Links OrgMember ‚Üí Event
   - Sets stage = "in_funnel"
   - Tracks pipeline per event
```

### Event Pipeline Tracking

```
Contact: John Smith
  ‚Üì
EventAttendee (Bros & Brews):
  currentStage: "in_funnel" ‚Üí "personal_invite" ‚Üí "soft_commit" ‚Üí "paid"
  ‚Üì
Update currentStage as John moves through funnel
  ‚Üì
EventAttendee.attended = true (when he shows up)
```

---

## üé® UI Flows

### Dashboard ‚Üí Create Event ‚Üí Invite People

1. **Dashboard** - Click "Create Event"
2. **EventCreate** - Enter event details
3. **EventSuccess** - Event created, click "Set Up Event Tasks"
4. **SetupEvent** - Survey (venue? team size? days until event?)
5. **EventTaskSuggestions** - Pick tasks from AI suggestions
6. **Tasks** - View/manage event tasks
7. **EventPipelines** - Invite people, track pipeline

### Inviting People to Event

**From EventPipelines page:**
1. Click "Add People"
2. Options:
   - Import CSV (creates new OrgMembers)
   - Select from existing OrgMembers
   - Tag-based selection ("Board", "Committee")
3. System creates EventAttendee records
4. Track their progress through pipeline

---

## üîÆ Future Enhancements

### Multi-Org Donor Tracking
```prisma
model Supporter {
  // Track donors across multiple orgs
  orgs SupporterOrgRelation[]
}

model SupporterOrgRelation {
  supporterId String
  orgId String
  relationship String // "donor", "volunteer", "board"
  totalGiven Float
}
```

### Team Delegation
```prisma
model OrgMember {
  role String? // "owner", "manager", "member", "volunteer"
  
  // Permissions
  canCreateEvents Boolean
  canManageContacts Boolean
  canSendCampaigns Boolean
}
```

### Campaign Tracking
```prisma
model Campaign {
  // Email/SMS campaign
  contactListId String
  templateId String
  
  // Track opens, clicks, replies
  analytics CampaignAnalytics[]
}
```

---

## üìù Summary

**Active Models:**
- ‚úÖ `OrgMember` - Master contact list (everyone)
- ‚úÖ `EventAttendee` - Event participation tracking
- ‚úÖ `Event` - Events/fundraisers
- ‚úÖ `EventTask` - Asana-style tasks
- ‚úÖ `EventLocation` - Reusable venues

**Breadcrumb Models (Future):**
- üî∏ `Supporter` - External donors (nonprofits)
- üî∏ `EventPipelineEntry` - Legacy pipeline (may deprecate)

**Philosophy:**
- Keep it simple now
- Build for future flexibility
- Document the why

